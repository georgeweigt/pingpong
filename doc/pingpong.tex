\documentclass[12pt]{article}
\usepackage{amsmath}
\parindent=0pt
\begin{document}

This is a C code project for learning about Ethereum communication.

\bigskip
For example, consider the following documentation
from the Ethereum project website.\footnote{\tt https://github.com/ethereum/devp2p/blob/master/rlpx.md}

\begin{quote}
Alice wants to send an encrypted message that can be decrypted by Bob's static private key $k_B$.
Alice knows about Bob's static public key $K_B$.

\medskip
To encrypt the message $m$, Alice generates a random number $r$
and corresponding elliptic curve public key $R=r*G$ and computes the
shared secret $S=P_x$ where $(P_x,P_y)=r*K_B$.
She derives key material for encryption and authentication as
$k_E\,\|\,k_M=\text{\tt KDF}(S,32)$
as well as a random initialization vector \verb$iv$.
Alice sends the encrypted message $R\,\|\,\text{\tt iv}\,\|\,c\,\|\,d$
where $c=\text{\tt AES}(k_E,\text{\tt iv},m)$
and $d=\text{\tt MAC}\big(\text{\tt sha256}(k_M),\text{\tt iv}\,\|\,c\big)$ to Bob.
\end{quote}

Let
\begin{align*}
r&=\text{\footnotesize\tt ephemeral\_private\_key}
\\
R&=\text{\footnotesize\tt ephemeral\_public\_key}
\\
S&=\text{\footnotesize\tt shared\_secret}
\\
K_B&=\text{\footnotesize\tt peer\_public\_key}
\\
k_E&=\text{\footnotesize\tt aes\_key}
\\
k_M&=\text{\footnotesize\tt hmac\_key}
\end{align*}

Then this is the code for $r$ and $R=r*G$.
{\footnotesize
\begin{verbatim}
// generate ephemeral_private_key and ephemeral_public_key
ec_genkey(ephemeral_private_key, ephemeral_public_key);
\end{verbatim}
}

\bigskip
This is the code for $S=P_x$ where $(P_x,P_y)=r*K_B$.
{\footnotesize
\begin{verbatim}
// derive shared_secret from ephemeral_private_key and peer_public_key
ec_ecdh(shared_secret, ephemeral_private_key, peer_public_key);
\end{verbatim}
}

\bigskip
And this is the code for $k_E\,\|\,k_M=\text{\tt KDF}(S,32)$.
{\footnotesize
\begin{verbatim}
// derive AES and HMAC keys from shared_secret
kdf(aes_key, hmac_key, shared_secret);
\end{verbatim}
}

\end{document}
